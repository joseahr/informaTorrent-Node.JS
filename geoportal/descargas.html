<!DOCTYPE>
<html>
<head>
<meta charset="utf-8">
<title>Geoportal de Torrent - Visor de descargas</title>
<meta name="description" content="Tu portal de Información Geográfica">
<!-- Para dispositivos móviles -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<!-- Font Awesome Iconos -->
<link rel="stylesheet" href="/stylesheets/font-awesome/css/font-awesome.css">

<!-- Fuentes -->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700,300&amp;subset=latin,latin-ext' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Raleway:700,400,300' rel='stylesheet' type='text/css'>

<!-- CSS Principal -->
<link rel="stylesheet" href="/stylesheets/style.css">

<!-- CSS Animaciones -->
<link rel="stylesheet" href="/stylesheets/animations.css">

<!-- Highlight CSS -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/default.min.css">

<!-- LayerSwitcher CSS -->
<link rel="stylesheet" href="/javascripts/plugins/ol3-layerswitcher/src/ol3-layerswitcher.css">

<!-- OpenLayers CSS -->
<link rel="stylesheet" href="/javascripts/plugins/ol3/ol.css" type="text/css">

<!-- CSS OpenLayers Popup -->
<link rel="stylesheet" href="http://openlayers.org/en/v3.11.0/examples/popup.css">

<!-- Bootstrap Select CSS -->
<link rel="stylesheet" href="/javascripts/plugins/bootstrap-select/dist/css/bootstrap-select.css">

<!-- Prefix free -->
<script src="https://raw.githubusercontent.com/LeaVerou/prefixfree/gh-pages/prefixfree.min.js"></script>
<!-- SIDEBAR CSS -->
<link href="/javascripts/plugins/bootstrap-sidebar/dist/css/sidebar.css" rel="stylesheet">
<!--Context-Menu CSS-->
<link rel='stylesheet', href='/javascripts/plugins/ol3-contextmenu/build/ol3-contextmenu.min.css'>

</head>

<body class="no-trans" style="margin-top: -10px;">
	<div style="background: rgba(255,255,255, 1); top: 0px !important; box-shadow: 5px 0px 15px 1px rgba(50, 50, 50, 0.5);" class="col-xs-7 col-sm-3 col-md-2 sidebar sidebar-left sidebar-animate">
  		<!--content-->
 		<div style="padding: 10 0 10 0px; border-bottom: 1px solid rgba(0,0,0,0.6)" class="media">
  			<a class="media-left"><img src="/files/images/logo-ayunt.png"/></a>
  		</div>
  		<div style="padding: 0px" class="col-xs-12">
		    <div class="menu-item col-xs-12"><a target="_blank" href="/"> <i class="fa fa-home"></i> Inicio</a></div>
		    <div class="menu-item col-xs-12"><a target="_blank" href="/#servicios"> <i class="fa fa-cogs"></i> Servicios OGC</a></div>
		    <div class="menu-item col-xs-12"><a target="_blank" href="http://192.168.1.14:8080/geonetwork"> <i class="fa fa-search"></i> Buscador Metadatos</a></div>
		    <div class="menu-item col-xs-12"><a target="_blank" href="/#descargas"> <i class="fa fa-download"></i> Descargas</a></div>
		</div>
	</div>
	<!-- section start -->
	<!-- ================ -->
	<div id="map" class="clearfix object-non-visible" data-animation-effect="fadeInRightBig">
		<!-- Boton abrir lateral -->
		<ul>
      	<li style="position: absolute; top: 8.5em; right: 0.5em;z-index: 1; border-radius: 5px;">
        	<a class="navbar-toggle" data-toggle="sidebar" data-target=".sidebar" href="#" style="padding: 0px; margin: 0px;">
            	<i class="fa fa-navicon" style="font-size: 2em;"></i>
            </a>
        </li>
        </ul>
		<!-- Selector Capas Descargar -->
		<div style="position: absolute; top: 0.5em; left: 20%; right: 20%; z-index: 2" class="btn-map">
			<select id="capas_mapa" class="selectpicker" data-style="btn-info" data-live-search="false" style="width: 100%">
		   		<option value="jahr:muni_torrent">Municipio</option>
	 			<option value="jahr:manzanas">Manzanas</option>
	 			<option value="jahr:viales">Viales</option>
	 			<option value="jahr:caminos">Caminos</option>
	 			<option value="jahr:portales">Portales</option>
	 			<option value="jahr:nombres_viales">Etiquetado Calles</option>
	 			<option value="jahr:denuncias_puntos">Denuncias Puntual</option>
	 			<option value="jahr:denuncias_lineas">Denuncias Lineal</option>
	 			<option value="jahr:denuncias_poligonos">Denuncias Polígonal</option>
		   	</select>
		</div>
	</div>
	<!-- section end -->
	

<!-- Plugins Javascript situados al final de la página, así el contenido carga antes -->

<!-- JQuery y Bootstrap -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

<!-- Modernizr -->
<script type="text/javascript" src="/javascripts/plugins/modernizr.js"></script>

<!-- Jquery appear -->
<script type="text/javascript" src="/javascripts/plugins/jquery.appear.js"></script>

<!-- JS Principal -->
<script type="text/javascript" src="/javascripts/template.js"></script>

<!-- FitText.js  -->
<script type="text/javascript" src="/javascripts/plugins/jquery.fittext.js"></script>

<!-- Bootstrap Dialog JS (Nakupanda)  -->
<script type="text/javascript" src="/javascripts/plugins/bootstrap-dialog.js"></script>

<!-- Highlight JS -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>

<!-- Proj4.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.12/proj4.js"></script>

<!-- OpenLayers.js -->
<script src="/javascripts/plugins/ol3/ol.js"></script>

<!-- LayerSwitcher JS -->
<script src="/javascripts/plugins/ol3-layerswitcher/src/ol3-layerswitcher.js"></script>

<!-- Estilos Features -->
<script src="/javascripts/openlayers/style.js"></script>

<!-- proyección -->
<script src="/javascripts/openlayers/proj.js"></script>

<!-- Capas -->
<script src="/javascripts/openlayers/capas.js"></script>	

<!-- Bootstrap Select JS -->
<script src="/javascripts/plugins/bootstrap-select/js/bootstrap-select.js"></script>

<!-- Mobile-Detect JS -->
<script src="//cdnjs.cloudflare.com/ajax/libs/mobile-detect/1.3.0/mobile-detect.min.js"></script>

<!-- SIDEBAR JS -->
<script src="/javascripts/plugins/bootstrap-sidebar/dist/js/sidebar.js"></script>

<!--Context-Menu JS-->
<script src='/javascripts/plugins/ol3-contextmenu/build/ol3-contextmenu.js'></script>

<script type="text/javascript">

$('.selectpicker').selectpicker({
	width: '100%'
}).selectpicker('mobile');

$("h1, h2").each(function(){
	var fontSize = $(this).css('font-size');
	console.log(fontSize);
	$(this).fitText(1.1, {maxFontSize: fontSize});
});

//MousePosition Control --> ol.control.MousePosition
var mousePositionControl = new ol.control.MousePosition({
    coordinateFormat: ol.coordinate.toStringHDMS,
});

// Mapa --> ol.Map
var map = new ol.Map({
	controls: ol.control.defaults({ 
		attribution: false // No atribución
	}).extend([mousePositionControl, // MousePosition
	           new ol.control.FullScreen(), // FullScreen
	           new ol.control.LayerSwitcher({tipLabel: 'Leyenda'}), // LayerSwitcher
	           new ol.control.ScaleLine(), // ScaleLine
	           new ol.control.ZoomSlider(), // ZoomSlider
	]),
	target: 'map',
	view: new ol.View({
		projection: proj,
		zoom: 3,
		center: ol.proj.fromLonLat([-0.47343, 39.42811], 'EPSG:4258'),
		minZoom: 0,
		maxZoom: 10
		// Importante poner nuestra proyección, aunque es un parámetro opcional HAY QUE PONERLO!
	})
});

var imprimir_mapa = function(){
  map.once('postcompose', function(event) {
    var canvas = event.context.canvas;
    var image = new Image();
    image.crossOrigin = "anonymous";
    try {
    	image.src = canvas.toDataURL('image/png');
    }
    catch(e){
    	BootstrapDialog.show({
    		title : 'Error exportando mapa', 
    		message : 'Vuelva a recargar la página y pruebe otra vez. No añada capas de servidores externos.',
    		onshow : function(dialog){$(dialog.getModalHeader()).css('background', 'rgb(200,50,50)')}
    	});
    }
    //window.open(image.src);

    var a = document.createElement('a');

    a.setAttribute('href', image.src);
    a.setAttribute('download', 'export_mapa_torrent.png');
    a.setAttribute('target', 'blank_');

    document.body.appendChild(a);
    a.click();

    map.renderSync();

  });

},
contextmenu_items = [{
    text: '<i class="fa fa-print"></i> Imprimir mapa',
    callback: imprimir_mapa
  },
  '-' // Separador
],
contextmenu = new ContextMenu({
  width: 190,
  default_items: true,
  items: contextmenu_items
});
map.addControl(contextmenu);

denuncias_puntos.setVisible(false);
denuncias_lineas.setVisible(false); 
denuncias_poligonos.setVisible(false); 
denunciasHeatMap.setVisible(false);

map.addLayer(groupCapasBase); // Añadimos grupo de Capas 1
map.addLayer(groupCartoTorrentWMST); // Añadimos grupo de Capas 2
map.addLayer(groupCartoTorrentWMS); // Añadimos grupo de Capas 2


// Añadimos Control OverviewMap
map.addControl(new ol.control.OverviewMap({
	   layers: [new ol.layer.Tile(ignBase.getProperties())], 
	   view: new ol.View({ // Importante añadir la View con nuestra proyección
		   projection: proj  
	   })
}));

ignBase.setVisible(false);

// FIN MAPA


</script>

<script src="/javascripts/openlayers/controles/download_bbox.js"></script>
<script src="/javascripts/openlayers/controles/close_header.js"></script>
<script src="/javascripts/openlayers/controles/draw.js"></script>
<script type="text/javascript">
	map.addControl(new app.BBOX());
</script>
</body>
</html>